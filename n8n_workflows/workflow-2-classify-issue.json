{
  "name": "Workflow #2: Issueè‡ªå‹•åˆ†é¡",
  "active": true,
  "nodes": [
    {
      "id": "webhook-trigger",
      "name": "GitHub Issue Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 300],
      "parameters": {
        "path": "github-issue-classify",
        "httpMethod": "POST",
        "responseMode": "lastNode"
      }
    },
    {
      "id": "check-action",
      "name": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¤å®š",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [450, 300],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.action}}",
              "operation": "equals",
              "value2": "opened"
            }
          ]
        }
      }
    },
    {
      "id": "extract-issue-data",
      "name": "Issue ãƒ‡ãƒ¼ã‚¿æŠ½å‡º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 250],
      "parameters": {
        "jsCode": "const issue = $input.item.json.issue;\nconst title = issue.title.toLowerCase();\nconst body = (issue.body || '').toLowerCase();\nconst text = title + ' ' + body;\n\nreturn [{\n  json: {\n    issue_number: issue.number,\n    issue_url: issue.html_url,\n    node_id: issue.node_id,\n    title: issue.title,\n    body: issue.body,\n    text: text,\n    repository: $input.item.json.repository.full_name\n  }\n}];"
      }
    },
    {
      "id": "classify-issue",
      "name": "ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ†é¡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 250],
      "parameters": {
        "jsCode": "const text = $input.item.json.text;\nconst labels = [];\nlet assignee = null;\n\n// å„ªå…ˆåº¦åˆ¤å®š\nif (text.includes('ç·Šæ€¥') || text.includes('asap') || text.includes('urgent')) {\n  labels.push('priority: high');\n  assignee = 'kenichimiyata';\n} else if (text.includes('ä½å„ªå…ˆåº¦') || text.includes('low priority')) {\n  labels.push('priority: low');\n} else {\n  labels.push('priority: medium');\n}\n\n// ã‚«ãƒ†ã‚´ãƒªåˆ¤å®š\nif (text.includes('ãƒã‚°') || text.includes('bug') || text.includes('ã‚¨ãƒ©ãƒ¼') || text.includes('error')) {\n  labels.push('bug');\n  assignee = 'poe-dari-san';\n} else if (text.includes('æ©Ÿèƒ½è¿½åŠ ') || text.includes('feature') || text.includes('enhancement')) {\n  labels.push('enhancement');\n  if (!assignee) assignee = 'kenichimiyata';\n} else if (text.includes('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ') || text.includes('document') || text.includes('docs')) {\n  labels.push('documentation');\n  labels.push('priority: low');\n}\n\n// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ‹…å½“è€…\nif (!assignee) {\n  assignee = 'kenichimiyata';\n}\n\nreturn [{\n  json: {\n    issue_number: $input.item.json.issue_number,\n    issue_url: $input.item.json.issue_url,\n    node_id: $input.item.json.node_id,\n    title: $input.item.json.title,\n    labels: labels,\n    assignee: assignee,\n    repository: $input.item.json.repository\n  }\n}];"
      }
    },
    {
      "id": "add-labels",
      "name": "ãƒ©ãƒ™ãƒ«è¿½åŠ ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1050, 200],
      "parameters": {
        "url": "=https://api.github.com/repos/{{$json.repository}}/issues/{{$json.issue_number}}/labels",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{$env.GITHUB_TOKEN}}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github+json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"labels\": $json.labels } }}"
      }
    },
    {
      "id": "assign-user",
      "name": "æ‹…å½“è€…ã‚¢ã‚µã‚¤ãƒ³",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1050, 300],
      "parameters": {
        "url": "=https://api.github.com/repos/{{$('classify-issue').item.json.repository}}/issues/{{$('classify-issue').item.json.issue_number}}/assignees",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{$env.GITHUB_TOKEN}}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github+json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"assignees\": [$('classify-issue').item.json.assignee] } }}"
      }
    },
    {
      "id": "notify-chat",
      "name": "åˆ†é¡å®Œäº†é€šçŸ¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1250, 250],
      "parameters": {
        "url": "={{$env.GOOGLE_CHAT_WEBHOOK}}",
        "method": "POST",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { cardsV2: [{ card: { header: { title: \"ğŸ·ï¸ Issueè‡ªå‹•åˆ†é¡å®Œäº†\", subtitle: \"Issue #\" + $('classify-issue').item.json.issue_number, imageUrl: \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\" }, sections: [{ header: \"åˆ†é¡çµæœ\", widgets: [ { textParagraph: { text: \"<b>ã‚¿ã‚¤ãƒˆãƒ«:</b><br>\" + $('classify-issue').item.json.title } }, { textParagraph: { text: \"<b>ãƒ©ãƒ™ãƒ«:</b> \" + $('classify-issue').item.json.labels.join(', ') } }, { textParagraph: { text: \"<b>æ‹…å½“è€…:</b> @\" + $('classify-issue').item.json.assignee } } ] }, { widgets: [{ buttonList: { buttons: [{ text: \"Issue ã‚’é–‹ã\", onClick: { openLink: { url: $('classify-issue').item.json.issue_url } } }] } }] }] } }] } }}"
      }
    },
    {
      "id": "return-response",
      "name": "ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1450, 250],
      "parameters": {
        "jsCode": "return [{\n  json: {\n    status: 'success',\n    message: 'Issueåˆ†é¡å®Œäº†',\n    issue_number: $('classify-issue').item.json.issue_number,\n    labels: $('classify-issue').item.json.labels,\n    assignee: $('classify-issue').item.json.assignee\n  }\n}];"
      }
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "check-action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-action": {
      "main": [
        [
          {
            "node": "extract-issue-data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "extract-issue-data": {
      "main": [
        [
          {
            "node": "classify-issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "classify-issue": {
      "main": [
        [
          {
            "node": "add-labels",
            "type": "main",
            "index": 0
          },
          {
            "node": "assign-user",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "add-labels": {
      "main": [
        [
          {
            "node": "notify-chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "assign-user": {
      "main": [
        [
          {
            "node": "notify-chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "notify-chat": {
      "main": [
        [
          {
            "node": "return-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "ai-automation",
      "id": "auto-2"
    }
  ]
}
